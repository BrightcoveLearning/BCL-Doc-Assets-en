<link rel="stylesheet" type="text/css" href="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/js/datepickr/datepickr.css" />
<section class="bcls-section">
<h2 id="Dependencies">Dependencies</h2>

<p>3rd party libraries used in this sample:</p>

<ul>
	<li><a href="https://github.com/joshsalverda/datepickr">Datapickr</a></li>
</ul>
</section>

<section class="bcls-section">
<h2 id="gettingCredentials" class="bcls-expander-head">Getting Credentials</h2>

<div class="bcls-expander-content">
<p>To get a <code>client_id</code> and <code>client_secret</code>, you will need to go to the OAuth UI and register this app:</p>

<ul>
	<li><a href="/node/14056">Managing API Authentication Credentials</a></li>
</ul>

<p>These are the permissions you will need:</p>

<figure class="bcls-figure"><img class="bcls-image" alt="Analytics API Permissions" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/analytics-api/aapi-permissions.png" />
<figcaption class="bcls-caption--image">Analytics API Permissions</figcaption>
</figure>

<p>You can also get your credentials via CURL or Postman - see:</p>

<ul>
	<li><a href="/node/17924">Get Client Credentials Using CURL</a></li>
	<li><a href="/node/17923">Get Client Credentials Using Postman</a></li>
</ul>

<p>If you are getting credentials directly from the API, these are the permissions you need:</p>

<pre class="line-numbers">
<code class="language-json">[
  "video-cloud/analytics/read",
  "video-cloud/video/read"
]</code></pre>
</div>
</section>

<section class="bcls-section">
  <h2 id="Codepen">Codepen</h2>
  <p data-height="1400" data-theme-id="dark" data-slug-hash="pLYvEV" data-default-tab="result" data-user="rcrooks1969" data-embed-version="2" data-pen-title="Analytics API Sample: Video Report by Player and Day" class="codepen">See the Pen <a href="https://codepen.io/team/rcrooks1969/pen/pLYvEV/">Analytics API Sample: Video Report by Player and Day</a> by Brightcove Learning Services (<a href="https://codepen.io/rcrooks1969">@rcrooks1969</a>) on <a href="https://codepen.io">CodePen</a>.</p>
  <script async src="https://static.codepen.io/assets/embed/ei.js"></script></section>

<section class="bcls-section">
<h2 id="code">Code for the sample</h2>

<p>The JavaScript code for this sample is shown below â€” view source to see the full page code.</p>

<pre class="line-numbers">
<code class="language-javascript">var BCLS = (function (window, document, datepickr) {
    var callNumber = 0,
        useMyAccount = document.getElementById("useMyAccount"),
        basicInfo = document.getElementById("basicInfo"),
        accountID = document.getElementById("accountID"),
        client_id = document.getElementById("client_id"),
        client_secret = document.getElementById("client_secret"),
        dateSelector = document.getElementById("dateSelector"),
        playerSelector = document.getElementById("playerSelector"),
        videoSelector = document.getElementById("videoSelector"),
        reportTableBody = document.getElementById("reportTableBody"),
        csvDisplay = document.getElementById('csvDisplay'),
        proxyURL = "https://solutions.brightcove.com/bcls/bcls-proxy/analyitcs-by-player-day-proxy.php",
        currentPlayerIndex = 0,
        currentVideoIndex = 0,
        currentDayIndex = 0,
        currentPlayer,
        currentPlayerName,
        currentVideo,
        currentVideoName,
        currentDay,
        playerMax,
        videoMax,
        dayMax,
        daysArray = [],
        dateToMS,
        dateFromMS,
        videoData,
        playerData,
        playersArray = [],
        analyticsData = {},
        playerID,
        videoID,
        dayMS,
        fromDate = document.getElementById("fromDatePicker"),
        toDate = document.getElementById("toDatePicker"),
        getData = document.getElementById("getData"),
        requestDisplay = document.getElementById('requestDisplay'),
        gettingDataDisplay = document.getElementById("gettingDataDisplay"),
        today = new Date(),
        monthAgo = new Date(today - (30 * 24 * 60 * 60 * 1000)),
        playerSelectTemplate = "{{#items}}&lt;option value="\&quot;{{player}}\&quot;"&gt;{{player_name}}{{/items}}", videoSelectTemplate = "{{#items}}&lt;/option&gt;&lt;option value="\&quot;{{video}}\&quot;"&gt;{{video_name}}{{/items}}", callType; /** * Logging function - safe for IE * @param {string} context description of the data * @param {*} message the data to be logged by the console * @return {} */ function bclslog(context, message) { if (window["console"] &amp;&amp; console["log"]) { console.log(context, message); } return; } // more robust test for strings "not defined" function isDefined (v) { if (v === "" || v === null || v === undefined || v === NaN) { return false; } return true; } /** * get the 3-letter name for a month * @param {number} month 0-based number of the month */ function getMonthName(month) { var name; switch (parseInt(month)) { case 0: name = "Jan"; break; case 1: name = "Feb"; break; case 2: name = "Mar"; break; case 3: name = "Apr"; break; case 4: name = "May"; break; case 5: name = "Jun"; break; case 6: name = "Jul"; break; case 7: name = "Aug"; break; case 8: name = "Sep"; break; case 9: name = "Oct"; break; case 10: name = "Nov"; break; case 11: name = "Dec"; break; } return name; } function displayData() { var displayStr, csvDisplayString = '', playerObject, videoObject, template, i, iMax, item; currentPlayer = playerSelector.options[playerSelector.selectedIndex].value; // bclslog('currentPlayer', currentPlayer); currentVideoIndex = videoSelector.selectedIndex; playerObject = analyticsData[currentPlayer]; // bclslog('analyticsData[currentPlayer]', analyticsData[currentPlayer]); // bclslog('currentVideoIndex', currentVideoIndex); // bclslog('playerObject.items[currentVideoIndex]', playerObject.items[currentVideoIndex]); videoObject = playerObject.items[currentVideoIndex]; // bclslog('videoObject', videoObject); displayStr = "" + playerObject.player_name + ""; cvsDisplayString = '"Video Name","","Total Plays","Total Average Seconds Viewed","Total Seconds Viewed" \n'; displayStr += '' + videoObject.video_name + 'Totals' + videoObject.totalPlays + '' + videoObject.totalAvgSecondsViewed + '' + videoObject.totalSecondsViewed + ''; csvDisplayString += '"' + videoObject.video_name + '","Totals","' + videoObject.totalPlays + '","' + videoObject.totalAvgSecondsViewed + '","' + videoObject.totalSecondsViewed + '" \n' + '"Date","Views","Avg Viewed Seconds","Total Viewed Seconds" \n'; iMax = videoObject.items.length; for (i = 0; i &lt; iMax; i++) { item = videoObject.items[i]; displayStr += '' + item.date + '' + item.video_view + '' + item.avgSecondsViewed + '' + item.totalSecondsViewed + ''; csvDisplayString += '"' + item.date + '","' + item.video_view + '","' + item.avgSecondsViewed + '","' + item.totalSecondsViewed + '" \n'; } csvDisplay.value = csvDisplayString; reportTableBody.innerHTML = displayStr; } function getTotals() { var player, video, i, iMax, j, jMax, item, date, thisVideo; for (player in analyticsData) { jMax = analyticsData[player].items.length; for (j = 0; j &lt; jMax; j++) { thisVideo = analyticsData[player].items[j]; iMax = thisVideo.items.length; thisVideo.totalPlays = 0; thisVideo.totalSecondsViewed = 0; thisVideo.totalCompletedViews = 0; for (i = 0; i &lt; iMax; i++) { item = thisVideo.items[i]; if (isDefined(item.date)) { date = new Date(item.date); item.date = dateToISO(date); thisVideo.totalPlays += item.video_view; thisVideo.totalSecondsViewed += item.totalSecondsViewed; } else { bclslog('item with no date', item); } } if (thisVideo.totalPlays &gt; 0) { thisVideo.totalAvgSecondsViewed = thisVideo.totalSecondsViewed / thisVideo.totalPlays; thisVideo.totalCompletedViews = thisVideo.totalCompletedViews / thisVideo.totalPlays; } else { thisVideo.totalAvgSecondsViewed = 0; thisVideo.totalCompletedViews = 0; } gettingDataDisplay.textContent = 'Data processing complete'; } } } function makeAnalyticsCall(callURL) { var httpRequest = new XMLHttpRequest(), options = {}, newItem = {}, data, requestParams, newEl, txt, getResponse = function () { var i, j, k, player, video, itemsmax, analytics, item, newItem = {}, thisVideo; try { if (httpRequest.readyState === 4) { if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) { data = JSON.parse(httpRequest.responseText); bclslog('data', data); } else { alert('There was a problem with the request. Request returned ' + httpRequest.status); } } } catch (e) { bclslog('e', e); } if (isDefined(data)) { switch (callType) { case "players": frag = new DocumentFragment(); callNumber++; // save the data for getting the analytics playerData = data; newEl = document.createElement('option'); txt = document.createTextNode('Select a Player'); newEl.appendChild(txt); frag.appendChild(newEl); playerMax = playerData.items.length; // add players to the analytics data object for (i = 0; i &lt; playerData.items.length; i++) { playerData.items[i].player = (isDefined(playerData.items[i].player)) ? playerData.items[i].player : "noPlayerId"; if (playerData.items[i].player !== "noPlayerId") { playersArray.push(playerData.items[i].player); } playerData.items[i].player_name = (isDefined(playerData.items[i].player_name)) ? playerData.items[i].player_name : "noPlayerName"; if (isDefined(playerData.items[i].player)) { analyticsData[playerData.items[i].player] = {}; analyticsData[playerData.items[i].player].player_name = playerData.items[i].player_name; analyticsData[playerData.items[i].player].items = []; } newEl = document.createElement('option'); txt = document.createTextNode(playerData.items[i].player_name); newEl.appendChild(txt); newEl.setAttribute('value', playerData.items[i].player); frag.appendChild(newEl); } // populate the player selector playerSelector.appendChild(frag); playerSelector.options[0].setAttribute("selected", "selected"); getVideoData(); break; case "videos": frag = new DocumentFragment(); callNumber++; // save the data for getting the analytics videoData = data; newEl = document.createElement('option'); txt = document.createTextNode('Select a Video'); newEl.appendChild(txt); frag.appendChild(newEl); // add videos to the analytics data object videoMax = videoData.items.length; for (player in analyticsData) { for (j = 0; j &lt; videoMax; j++) { video = videoData.items[j]; video.video_name = (isDefined(video.video_name)) ? video.video_name : "unknown"; video.video = (isDefined(video.video)) ? video.video : "unknown"; analyticsData[player].items[j] = {}; analyticsData[player].items[j].id = video.video; analyticsData[player].items[j].video_name = video.video_name; analyticsData[player].items[j].items = []; newEl = document.createElement('option'); txt = document.createTextNode(video.video_name); newEl.appendChild(txt); newEl.setAttribute('value', video.video); frag.appendChild(newEl); } } // populate the video selector videoSelector.appendChild(frag); videoSelector.options[0].setAttribute("selected", "selected"); getAnalyticsData(); break; case "analytics": callNumber++; itemsmax = data.items.length; // bclslog('data',data); videoMax = analyticsData[currentPlayer].items.length; for (k = 0; k &lt; videoMax; k++) { thisVideo = analyticsData[currentPlayer].items[k]; newItem = {}; newItem.video_view = 0; newItem.avgSecondsViewed = 0; newItem.totalSecondsViewed = 0; newItem.date = currentDay.from; for (i = 0; i &lt; itemsmax; i++) { if (data.items[i].video === thisVideo.id) { item = data.items[i]; newItem.video_view = item.video_view; newItem.avgSecondsViewed = item.video_seconds_viewed / item.video_view; newItem.totalSecondsViewed = item.video_seconds_viewed; } } analyticsData[currentPlayer].items[k].items.push(newItem); } if (currentDayIndex &lt; dayMax - 1) { currentDayIndex++; getAnalyticsData(); } else if (currentPlayerIndex &lt; playerMax - 1) { currentDayIndex = 0; currentVideoIndex = 0; currentPlayerIndex++; getAnalyticsData(); } else { gettingDataDisplay.textContent = "Data retrieved - " + callNumber + " API calls made - processing data..."; // bclslog("analyticsData", analyticsData); getTotals(); } break; } } }; if (isDefined(client_id.value)) { options.client_id = client_id.value; } if (isDefined(client_secret.value)) { options.client_secret = client_secret.value; } options.url = callURL; options.requestMethod = "GET"; options.requestData = null; // set up request data requestParams = 'url=' + encodeURIComponent(options.url) + '&amp;requestType=GET'; if (options.client_id &amp;&amp; options.client_secret) { requestParams += '&amp;client_id=' + options.client_id + '&amp;client_secret=' + options.client_secret; } // set response handler httpRequest.onreadystatechange = getResponse; // open the request httpRequest.open('POST', proxyURL); // set headers httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); // open and send request httpRequest.send(requestParams); } // get the analytics data for the videos function getAnalyticsData() { var callURL, account_id = (isDefined(accountID.value)) ? accountID.value : "1752604059001"; gettingDataDisplay.innerHTML = "Getting analytics data - making request number " + callNumber; callType = "analytics"; currentPlayer = playerData.items[currentPlayerIndex].player; // currentVideo = videoData.items[currentVideoIndex].video; currentDay = daysArray[currentDayIndex]; callURL = "https://analytics.api.brightcove.com/v1/data?accounts=" + account_id + "&amp;dimensions=video&amp;from=" + currentDay.from + "&amp;to=" + currentDay.to + "&amp;where=player==" + currentPlayer + "&amp;fields=video_view,video_seconds_viewed,video"; requestDisplay.textContent = callURL; makeAnalyticsCall(callURL); } // get the video analytics data function getVideoData() { var callURL = ""; account_id = (isDefined(accountID.value)) ? accountID.value : "1752604059001"; gettingDataDisplay.innerHTML = "Getting video data..."; callType = "videos"; callURL = "https://analytics.api.brightcove.com/v1/data?accounts=" + account_id + "&amp;dimensions=video&amp;limit=10&amp;fields=video,video_name&amp;sort=-video_view&amp;from=" + dateFromMS + "&amp;to=" + dateToMS; requestDisplay.textContent = callURL; makeAnalyticsCall(callURL); } // get all players for the selected time period function getPlayersData() { var callURL = ""; account_id = (isDefined(accountID.value)) ? accountID.value : "1752604059001"; gettingDataDisplay.innerHTML = "Getting player data..."; callType = "players"; callURL = "https://analytics.api.brightcove.com/v1/data?accounts=" + account_id + "&amp;dimensions=player&amp;limit=5&amp;fields=player,player_name&amp;sort=-video_view&amp;from=" + dateFromMS + "&amp;to=" + dateToMS; requestDisplay.textContent = callURL; makeAnalyticsCall(callURL); } // add date pickers to the date input fields datepickr(fromDate, { 'dateFormat': 'Y-m-d' }); datepickr(toDate, { 'dateFormat': 'Y-m-d' }); /** * return ISO 8601 date string (YYYY-MM-DD) for JS date * @param {Date} date a Date object * @return {String} the date in ISO format (date part only) */ function dateToISO(date) { var y = date.getFullYear(), m = date.getMonth(), d = date.getDate(), isoDate; y = y.toString(); m = m + 1; if (m &lt; 10) { m = "0" + m.toString(); } else { m = m.toString(); } if (d &lt; 10) { d = "0" + d.toString(); } else { d = d.toString(); } isoDate = y + "-" + m + "-" + d; return isoDate; } // default date range values toDate.value = dateToISO(today); fromDate.value = dateToISO(monthAgo); getData.addEventListener("click", function () { var totalDays, i; dateFromMS = new Date(fromDate.value).valueOf(); dateToMS = new Date(toDate.value).valueOf(); /** * what follows is just math * to create to and from params for API calls * 86400000 = 1 day in milliseconds */ totalDays = Math.round((dateToMS - dateFromMS)/86400000); for (i = 0; i &lt; (totalDays - 1); i++) { daysArray[i] = {from : dateFromMS + (i * 86400000), to : dateFromMS + ((i + 1) * 86400000) - 1}; } dayMax = daysArray.length; getPlayersData(); }); videoSelector.addEventListener("change", displayData); playerSelector.addEventListener("change", function() { videoSelector.setAttribute('style', ''); displayData(); }); useMyAccount.addEventListener("click", function () { if (basicInfo.getAttribute('style') === "display:none;") { basicInfo.setAttribute('style', 'display:block;'); useMyAccount.innerHTML = "Use Sample Account"; } else { basicInfo.setAttribute('style', 'display:none;'); useMyAccount.innerHTML = "Use My Account Instead"; } }); csvDisplay.addEventListener('click', function() { this.select(); }); })(window, document, datepickr);&lt;/option&gt;</code></pre>

<h3>Proxy</h3>

<aside class="bcls-aside bcls-aside--information">In order to build your own version of the sample app on this page, you must create and host your own proxy. (The proxies used by Brightcove Learning Services only accept requests from Brightcove domains.) You can download two versions of our proxy code:
<ul>
	<li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/bcls-proxy-for-distribution.php.zip">This is a general version that expects client credentials to be passed with the request</a></li>
	<li><a href="//learning-services-media.brightcove.com/doc-assets/proxy/doc-samples-proxy.php.zip">This version allows you to save your client credentials in the proxy itself on lines 25-26 (recommended)</a></li>
</ul>
</aside>
</section>
<!-- for date picker --><script type="text/javascript" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/js/datepickr/datepickr.js"></script><script id="pageScript" src="//learning-services-media.brightcove.com/doc-assets/video-cloud-apis/analytics-api/code-samples/video-report-by-player-and-day/video-reports-by-player-and-day.js"></script>
