<article class="bcls-article">
<section class="bcls-section">
<h2 id="Introduction">Introduction</h2>

<p>Getting access tokens is a crucial operation for most work with the Brightcove APIs, as the majority of them use access tokens to authenticate requests.</p>

<p>For a full explanation of access tokens, see <a href="/node/17928">how the Brightcove OAuth service works</a> and <a href="/node/17925">Getting Access Tokens</a>.</p>

<p>This sample shows you how to get an access token from a web app. Because the OAuth API is not CORS-enabled and requests must be made from the server side, the app sends information to a proxy, which then makes the api request and sends the response back to the client. The proxy here is written in PHP, but any server-side language will do - you just need to be able to send a POST request to the app over the internet.</p>
</section>

<section class="bcls-section">
<h2 id="gettingCredentials" class="bcls-expander-head">Getting Credentials</h2>

<div class="bcls-expander-content">
<p>To get a <code>client_id</code> and <code>client_secret</code>, you will need to go to the OAuth UI and register this app:</p>

<ul>
	<li><a href="/node/14056">Managing API Authentication Credentials</a></li>
</ul>

<p>These choose the permissions you will need for the API you are going to use:</p>

<figure class="bcls-figure"><img class="bcls-image" alt="API Permissions" src="//learning-services-media.brightcove.com/doc-assets/node/18520-oauth-api-sample-get-access-token/api-permissions.png" />
<figcaption class="bcls-caption--image">API Permissions</figcaption>
</figure>

<p>You can also get your credentials via CURL or Postman - see:</p>

<ul>
	<li><a href="/node/17924">Get Client Credentials Using CURL</a></li>
	<li><a href="/node/17923">Get Client Credentials Using Postman</a></li>
</ul>

<p>If you are getting credentials directly from the OAuth API, see <a href="/node/17922">API Operations for Client Credentials Requests</a> for the permissions you need for different API operations.</p>
</div>
</section>

<section class="bcls-section">
<h2 id="app">The app</h2>

<fieldset><legend>Inputs</legend>

<p>Client ID: <input id="clientId" type="text" size="50" /></p>

<p>Client Secret: <input id="clientSecret" type="text" size="50" /></p>

<p><button id="submitButton" class="bcls-button">Get Access Token</button></p>
</fieldset>

<fieldset><legend>Output</legend>

<h3>Access token</h3>
<textarea name="accessToken" id="accessToken" class="bcls-code">Access token will appear here...</textarea>

<h3>Full response</h3>

<pre class="line-numbers">
<code id="apiResponse" class="language-json">Full API response will appear here...</code></pre>
</fieldset>
</section>

<section class="bcls-section">
<h2 id="code">Code for the app</h2>

<h3>HTML</h3>

<pre class="line-numbers">
<code class="language-html">&lt;section class="bcls-section"&gt;
  &lt;h2 id="app"&gt;The app&lt;/h2&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;Inputs&lt;/legend&gt;
    &lt;p&gt;Client ID: &lt;input id="clientId" type="text" size="50"&gt;&lt;/p&gt;
    &lt;p&gt;Client Secret: &lt;input id="clientSecret" type="text" size="50"&gt;&lt;/p&gt;
    &lt;p&gt;&lt;button id="submitButton" class="bcls-button"&gt;Get Access Token&lt;/button&gt;&lt;/p&gt;
  &lt;/fieldset&gt;
  &lt;fieldset&gt;
    &lt;legend&gt;Output&lt;/legend&gt;
    &lt;h3&gt;Access token&lt;/h3&gt;
    &lt;textarea name="accessToken" id="accessToken" class="bcls-code"&gt;Access token will appear here...&lt;/textarea&gt;
    &lt;h3&gt;Full response&lt;/h3&gt;
  &lt;pre class="line-numbers"&gt;&lt;code id="apiResponse" class="language-json"&gt;Full API response will appear here...&lt;/code&gt;&lt;/pre&gt;
  &lt;/fieldset&gt;
&lt;/section&gt;
</code></pre>

<h3>JavaScript</h3>

<pre class="line-numbers">
<code class="language-javascript">var BCLS = ( function (window, document) {
  var clientId   = document.getElementById('clientId'),
    clientSecret = document.getElementById('clientSecret'),
    submitButton = document.getElementById('submitButton'),
    accessToken  = document.getElementById('accessToken'),
    apiResponse  = document.getElementById('apiResponse'),
    options      = {},
    proxyURL     = 'https://solutions.brightcove.com/bcls/bcls-proxy/access-token-proxy.php',
    access_token;

// event handlers
submitButton.addEventListener('click', function() {
  var responseParsed;
  if (isDefined(clientId.value) &amp;&amp; isDefined(clientSecret.value)) {
    options.client_id     = clientId.value;
    options.client_secret = clientSecret.value;
    makeRequest(options, function(response) {
      if (isJson(response)) {
        responseParsed          = JSON.parse(response);
        access_token            = responseParsed.access_token;
        accessToken.textContent = access_token;
        apiResponse.textContent = JSON.stringify(responseParsed, null, '  ');
      }
    });
  } else {
    // didn't get JSON back, just dump responseRaw
    apiResponse.textContent = response;
  }
});

accessToken.addEventListener('click', function() {
  this.select();
});

/**
 * tests for all the ways a variable might be undefined or not have a value
 * @param {*} x the variable to test
 * @return {Boolean} true if variable is defined and has a value
 */
function isDefined(x) {
    if ( x === '' || x === null || x === undefined) {
        return false;
    }
    return true;
}

/*
 * tests to see if a string is json
 * @param {String} str string to test
 * @return {Boolean}
 */
function isJson(str) {
    try {
        JSON.parse(str);
    } catch (e) {
        return false;
    }
    return true;
}

/**
 * send API request to the proxy
 * @param  {Object} options options for the request
 * @param  {String} requestID the type of request = id of the button
 * @param  {Function} [callback] callback function
 */
function makeRequest(options, callback) {
  var httpRequest = new XMLHttpRequest(),
    responseRaw,
    requestParams,
    // response handler
    getResponse = function() {
      try {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status &gt;= 200 &amp;&amp; httpRequest.status &lt; 300) {
            // check for completion
            responseRaw = httpRequest.responseText;
            callback(responseRaw);
          }
        }
      } catch (e) {
        alert('Caught Exception: ' + e);
      }
    };
  // set up request data
  requestParams = 'client_id=' + options.client_id + '&amp;client_secret=' + options.client_secret;

  // set response handler
  httpRequest.onreadystatechange = getResponse;
  // open the request
  httpRequest.open('POST', proxyURL);
  // set headers
  httpRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  // open and send request
  httpRequest.send(requestParams);
}

})(window, document);
</code></pre>

<h3>Proxy (PHP)</h3>

<pre class="line-numbers">
<code class="language-php">&lt;?php
/**
 * access-token-proxy.php - proxy for Brightcove RESTful APIs
 * gets an access token and returns the whole response
 * Accessing:
 *         (note you should *always* access the proxy via HTTPS)
 *     Method: POST
 *
 * @post {string} client_id - OAuth2 client id with sufficient permissions for the request
 * @post {string} client_secret - OAuth2 client secret with sufficient permissions for the request
 *
 * @returns {string} $response - JSON response received from the OAuth API
 */

// security checks
if (strpos($_SERVER['HTTP_REFERER'], 'solutions.brightcove.com') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 'ondemand.brightcovelearning.com') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 'video.brightcovelearning.com') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 's.codepen.io') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 'fiddle.jshell.net') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 'players.brightcove.net') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 'support.brightcove.com') == false &amp;&amp; strpos($_SERVER['HTTP_REFERER'], 'master-7rqtwti-6sglloa4yrkti.us.platform.sh') == false) {
    exit('{"ERROR":"Only requests from http://docs.brightcove.com or http:solutions.brightcove.com are accepted by this proxy"}');
}

// CORS enablement and other headers
header("Access-Control-Allow-Origin: *");
header("Content-type: application/json");
header("X-Content-Type-Options: nosniff");
header("X-XSS-Protection");

// set up request for access token
$data = array();

$client_id     = $_POST["client_id"];
$client_secret = $_POST["client_secret"];
$auth_string   = "{$client_id}:{$client_secret}";
$request       = "https://oauth.brightcove.com/v4/access_token?grant_type=client_credentials";
$ch            = curl_init($request);
curl_setopt_array($ch, array(
        CURLOPT_POST           =&gt; TRUE,
        CURLOPT_RETURNTRANSFER =&gt; TRUE,
        CURLOPT_SSL_VERIFYPEER =&gt; FALSE,
        CURLOPT_USERPWD        =&gt; $auth_string,
        CURLOPT_HTTPHEADER     =&gt; array(
            'Content-type: application/x-www-form-urlencoded',
        ),
        CURLOPT_POSTFIELDS =&gt; $data
    ));
$response = curl_exec($ch);
curl_close($ch);

// Check for errors
if ($response === FALSE) {
    die(curl_error($ch));
    echo 'An error occurred';
} else {
  echo $response;
}

?&gt;
</code></pre>
</section>
</article>
<script src="//learning-services-media.brightcove.com/doc-assets/node/18520-oauth-api-sample-get-access-token/get-token.js"></script>
